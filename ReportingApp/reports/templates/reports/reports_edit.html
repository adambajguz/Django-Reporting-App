{% extends "base_reports_quickactions.html" %}

{% load custom_tags %}
{% load widget_tweeks %}

{% block breadcrumbs %}
	{{ block.super }} Â» Edit Report
{% endblock %}

{% block cotainer_start %} 
	<form class="uk-form" method="post" name="edit_form" action="{% url 'reports_edit' id=report.id %}">
		{% csrf_token %}

{% endblock %}

{% block cotainer_end %} 
	</form>
{% endblock %}

{% block quick_actions %}
	{% for field in report_form.visible_fields %}
	<div class="uk-form-row">
		<label class="uk-form-label" for="{{ field.name }}">{{ field.label_tag|safe }}</label>

		{% if field.errors %}
		<div class="uk-alert uk-alert-danger">{{ field.errors.as_text }}</div>
		{% endif %}

		<div class="uk-form-controls">
			{{ field }}
			<p class="uk-form-help-block"><em>{{ field.help_text }}</em></p>
		</div>
	</div>
	{% endfor %}

	<p>Last modification: {{ report.report_last_modification }}</p>

	<hr style="color: #CCE6FF; border-color: #CCE6FF; background-color: #CCE6FF;">

	<p>Columns properties:</p>
	<div class="uk-panel uk-panel-box" style="max-height: 190px; overflow-y: scroll;">
		<dl class="uk-description-list-line">
			{% for column in columns %}
				<dt><em>{{ column.column_name }}</em></dt>
				<dd>
					<b>Use as: </b>
					<label>
						<input type="checkbox" name="data_col" value="{{ column.id }}" {% if column.id in data_columns %}checked{% endif %}>
						data source, 
					</label>
					<label>
						<input type="checkbox" name="grouping_col" value="{{ column.id }}" {% if column.id in grouping_columns %}checked{% endif %}>
						grouping
					</label>
				</dd>
			{% endfor %}
		</dl>
	</div>

	<hr style="color: #CCE6FF; border-color: #CCE6FF; background-color: #CCE6FF;">

	<button name="delete" value="Delete" class="uk-margin-bottom uk-button uk-button-danger"><i class="uk-icon-trash"></i> Delete plot</button>
	<button class="uk-margin-bottom uk-button uk-button-primary"><i class="uk-icon-save"></i> Save</button>
{% endblock %}

{% block content %}

<div class="uk-width-1-1">

		{{ report_element_formset.management_form }}

		<div class="uk-form uk-form-stacked">
			{% if report_element_formset.non_form_errors %}
				{% for error in report_element_formset.non_form_errors %}
					{{ error|escape }}
				{% endfor %}
			{% endif %}

			{% for element in report_element_formset %}
				<div class="link-formset">
					<div class="uk-form-row">
						{% if element.element_name.errors %}
							<div class="uk-alert uk-alert-danger">
								{% for error in element.element_name.errors %}
									{{ error|escape }}
								{% endfor %}
							</div>
						{% endif %}
						
						<label class="uk-form-label" for="{{ element.element_name.name }}">{{ element.element_name.label_tag|safe }}</label>

						<div class="uk-form-controls">
							{{ element.element_name }}
						</div>
					</div>
		
					<div class="uk-form-row">
						{% if element.element_order.errors %}
							<div class="uk-alert uk-alert-danger">
								{% for error in element.element_order.errors %}
									{{ error|escape }}
								{% endfor %}
							</div>
						{% endif %}

						<label class="uk-form-label" for="{{ element.element_order.name }}">{{ element.element_order.label_tag|safe }}</label>

						<div class="uk-form-controls">
							{{ element.element_order }}
						</div>
					</div>

					<div class="uk-form-row">
						<label class="uk-form-label" for="{{ element.element_order.name }}">{{ element.element_order.label_tag|safe }}</label>

						<div class="uk-form-controls">
							{{ element.element_type }}
						</div>
					</div>

					<div id="element-text">
						<div id="element-text">
							<div class="uk-form-row">
								<label class="uk-form-label" for="{{ element.text.name }}">{{ element.text.label_tag|safe }}</label>

								<div class="uk-form-controls">
									{{ element.text }}
								</div>
							</div>
						</div>
					</div>

					<div id="element-table-plot">
						<div class="uk-form-row">
							<label class="uk-form-label" for="{{ element.caption.name }}">{{ element.caption.label_tag|safe }}</label>

							<div class="uk-form-controls">
								{{ element.caption }}
							</div>
						</div>
					</div>

					<div id="element-table">
						<div class="uk-form-row">
							<label class="uk-form-label" for="{{ element.style.name }}">{{ element.style.label_tag|safe }}</label>

							<div class="uk-form-controls">
								{{ element.style }}
							</div>
						</div>
						
						<div class="uk-form-row">
							<label class="uk-form-label" for="{{ element.caption.name }}">{{ element.spreadsheet.label_tag|safe }}</label>
	
							<div class="uk-form-controls">
								{{ element.spreadsheet }}
							</div>
						</div>

						<div class="uk-form-row">
							<label class="uk-form-label" for="{{ element.columns.name }}">{{ element.columns.label_tag|safe }}</label>

							<div class="uk-form-controls">
								{{ element.columns }}
							</div>
						</div>
					</div>

					<div id="element-plot">
						<div class="uk-form-row">
							<label class="uk-form-label" for="{{ element.plot.name }}">{{ element.plot.label_tag|safe }}</label>

							<div class="uk-form-controls">
								{{ element.plot }}
							</div>
						</div>
					</div>

					<div id="element-report">
						<div class="uk-form-row">
							<label class="uk-form-label" for="{{ element.embedded_raport.name }}">{{ element.embedded_raport.label_tag|safe }}</label>

							<div class="uk-form-controls">
								{{ element.embedded_raport }}
							</div>
						</div>

						<div class="uk-form-row">
							<label class="uk-form-label" for="{{ element.element_start.name }}">{{ element.element_start.label_tag|safe }}</label>

							<div class="uk-form-controls">
								{{ element.element_start }}
							</div>
						</div>

						<div class="uk-form-row">
							<label class="uk-form-label" for="{{ element.element_end.name }}">{{ element.element_end.label_tag|safe }}</label>

							<div class="uk-form-controls">
								{{ element.element_end }}
							</div>
						</div>
					</div>
				</div>
				<hr>
			{% endfor %}
		</div>

</div>

<script>
	$('.link-formset').formset({
		addText: 'add link',
		deleteText: 'remove'
	});

	function myFunction(e) {
		var text = document.getElementById("element-text");
		var table_plot = document.getElementById("element-table-plot");
		var table = document.getElementById("element-table");
		var plot = document.getElementById("element-plot");
		var report = document.getElementById("element-report");

		var selected = e.target.value;
		console.log(selected)

		if (selected === "X") {
			text.style.display = "block";
			table_plot.style.display = "none";
			table.style.display = "none";
			plot.style.display = "none";
			report.style.display = "none";
		} else if (selected === "T") {
			text.style.display = "none";
			table_plot.style.display = "block";
			table.style.display = "block";
			plot.style.display = "none";
			report.style.display = "none";
		} else if (selected === "P") {
			text.style.display = "none";
			table_plot.style.display = "block";
			table.style.display = "none";
			plot.style.display = "block";
			report.style.display = "none";
		} else if (selected === "R") {
			text.style.display = "none";
			table_plot.style.display = "none";
			table.style.display = "none";
			plot.style.display = "none";
			report.style.display = "block";
		}

	}
</script>

{% endblock %}