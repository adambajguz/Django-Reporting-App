{% extends "base_reports_quickactions.html" %}

{% load custom_tags %}
{% load widget_tweeks %}

{% block breadcrumbs %}
	{{ block.super }} Â» Edit Report
{% endblock %}

{% block cotainer_start %} 

	<form class="uk-form" method="post" name="edit_form" action="{% url 'reports_edit' id=report.id %}">
		{% csrf_token %}

{% endblock %}

{% block cotainer_end %} 
	</form>
{% endblock %}

{% block quick_actions %}
	{% for field in report_form.visible_fields %}
	<div class="uk-form-row">
		<label class="uk-form-label" for="{{ field.name }}">{{ field.label_tag|safe }}</label>

		{% if field.errors %}
		<div class="uk-alert uk-alert-danger">{{ field.errors.as_text }}</div>
		{% endif %}

		<div class="uk-form-controls">
			{{ field }}
			<p class="uk-form-help-block"><em>{{ field.help_text }}</em></p>
		</div>
	</div>
	{% endfor %}

	<p>Last modification: {{ report.report_last_modification }}</p>

	<hr style="color: #CCE6FF; border-color: #CCE6FF; background-color: #CCE6FF;">

	<button name="add" value="Add" class="uk-button uk-button-success"><i class="uk-icon-plus"></i> Add element</button>

	<hr style="color: #CCE6FF; border-color: #CCE6FF; background-color: #CCE6FF;">

	<a class="uk-button uk-button-primary" 
		data-message="<i class='uk-icon-spinner uk-icon-spin'></i> Generating preview"
		href="{% url 'reports_preview' id=report.id %}">
			<i class="uk-icon-file-image-o"></i> Preview
	</a>
	<a class="uk-button uk-button-primary"
		data-message="<i class='uk-icon-spinner uk-icon-spin'></i> Generating PDF"
		href="{% url 'reports_pdf' id=report.id %}">
			<i class="uk-icon-file-pdf-o"></i> Generate PDF
	</a>
	

	<hr style="color: #CCE6FF; border-color: #CCE6FF; background-color: #CCE6FF;">

	<button name="delete" value="Delete" class="uk-margin-bottom uk-button uk-button-danger"><i class="uk-icon-trash"></i> Delete report</button>
	<button class="uk-margin-bottom uk-button uk-button-primary"><i class="uk-icon-save"></i> Save</button>

	<script>
			$(function(){
				$("body").on("click", ".uk-button[data-message]", function(){
					UIkit.notify($(this).data(), {
						status: 'primary',
						timeout: 5000,
					});
				});
			})		</script>
{% endblock %}

{% block content %}

<div class="uk-width-1-1">

		{% if not report_elements_count %}
			<table class="uk-table uk-table-hover uk-table-striped">
				<caption>You have {{ num_reports }} report{% if num_reports != 1%}s{% endif %}</caption>
			</table>
		{% endif %}


		<div class="uk-form uk-form-stacked" {% if not report_element_formset.instance.pk %}class="dynamic"{% endif %}>
			{{report_element_formset.management_form}}

			{% if report_element_formset.non_form_errors %}
				{% for error in report_element_formset.non_form_errors %}
					{{ error|escape }}
				{% endfor %}
			{% endif %}

			{% for element in report_element_formset %}

				<a class="uk-button uk-button-mini uk-border-circle" href="{% url 'reports_delete_element' id=report.id eid=element.id.value %}">
					<em><i class="uk-icon-remove"></i></em>
				</a>
				{{ element.id }}
				<div class="uk-form uk-form-stacked">
					<fieldset data-uk-margin class="uk-form-row">						
							<div class="uk-form-controls uk-form-controls-text">
								<p class="uk-form-controls-condensed">
									<b>{{ element.element_name.label_tag|safe }}</b>
									{{ element.element_name }}

									<b>{{ element.element_order.label_tag|safe }}</b>
									{{ element.element_order }}


								</p>
								<p>
									<b>{{ element.element_type.label_tag|safe }}</b>
									{{ element.element_type }}
								</p>
							</div>
					</fieldset>

					
					<div class="uk-form-row" {% if element.element_type.value != 'X' and element.element_type.value != None %}hidden{% endif %}>
						<div class="uk-form-label" for="{{ element.text.name }}">{{ element.text.label_tag|safe }}</div>

						<div class="uk-form-controls">
							{{ element.text }}
						</div>
					</div>

					<fieldset data-uk-margin class="uk-form-row">
						<div class="uk-form-controls uk-form-controls-text">
							<p class="uk-form-controls-condensed">
								<span>
									<span {% if element.element_type.value != 'T' and element.element_type.value != 'P' %}hidden{% endif %}>
										<b>{{ element.caption.label_tag|safe }}</b>
										{{ element.caption }}
									</span>
								</span>
								<span>
									<span {% if element.element_type.value != 'T' %}hidden{% endif %}>
										<b>{{ element.style.label_tag|safe }}</b>
										{{ element.style }}
									</span>
									<span {% if element.element_type.value != 'T' %}hidden{% endif %}>
										<b>{{ element.spreadsheet.label_tag|safe }}</b>
										{{ element.spreadsheet }}
									</span>
								</span>
								<span>
									<span {% if element.element_type.value != 'P' %}hidden{% endif %}>
										<b>{{ element.plot.label_tag|safe }}</b>
										{{ element.plot }}
									</span>
								</span>
							</p>
						</div>
					</fieldset>

					<fieldset data-uk-margin class="uk-form-row">
						<div class="uk-form-row" {% if element.element_type.value != 'R' %}hidden{% endif %}>
							<div class="uk-form-label" for="{{ element.embedded_raport.name }}">{{ element.embedded_raport.label_tag|safe }}</div>

							<div class="uk-form-controls">
								{{ element.embedded_raport }}
							</div>
						</div>

						<div class="uk-form-row" {% if element.element_type.value != 'R' %}hidden{% endif %}>
							<div class="uk-form-label" for="{{ element.element_start.name }}">{{ element.element_start.label_tag|safe }}</div>

							<div class="uk-form-controls">
								{{ element.element_start }}
							</div>
						</div>

						<div class="uk-form-row" {% if element.element_type.value != 'R' %}hidden{% endif %}>
							<div class="uk-form-label" for="{{ element.element_end.name }}">{{ element.element_end.label_tag|safe }}</div>

							<div class="uk-form-controls">
								{{ element.element_end }}
							</div>
						</div>
					</fieldset>
				</div>
				<hr>
			{% endfor %}
		</div>

</div>

{% if messages %}
   <script>
	{% for message in messages %}
	UIkit.notify('{% if 'safe' in message.tags %}{{ message|safe }}{% else %}{{ message }}{% endif %}', {% if message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}'success'
	{% elif message.level == DEFAULT_MESSAGE_LEVELS.WARNING %}'warning'{% else %} 'danger'{% endif %});    {% endfor %}
   </script>
{% endif %}


<script>
	function showOrHide(el, el_show) {
		var el_label = $('label[for=' + el.id + ']');
		if(el_show === true) {
			el.style.display = "block";
			$(el.parentElement).show();
			el_label.show();
			$(el.parentElement).show();
			$(el.parentElement.parentElement).show();
		} else {
			el.style.display = "none";
			$(el.parentElement).hide();
			el_label.hide();
			$(el_label.parentElement).hide();
			$(el.parentElement.parentElement).hide();
		}
	}

	function myFunction(e) {
		console.log("ONLOAD");
		console.log(e)
		var selected = e.target.value;
		var selected_id = e.target.id.match(/\d+/)[0]

		var text = document.getElementById("id_form-" + selected_id + "-text");

		var caption = document.getElementById("id_form-" + selected_id + "-caption");

		var style = document.getElementById("id_form-" + selected_id + "-style");
		var spreadsheet = document.getElementById("id_form-" + selected_id + "-spreadsheet");

		var plot = document.getElementById("id_form-" + selected_id + "-plot");

		var embedded_raport = document.getElementById("id_form-" + selected_id + "-embedded_raport");
		var element_start = document.getElementById("id_form-" + selected_id + "-element_start");
		var element_end = document.getElementById("id_form-" + selected_id + "-element_end");

		console.log()

		var text_show = false;
		var caption_show = false;
		var style_show = false;
		var spreadsheet_show = false;
		var columns_show = false;
		var plot_show = false;
		var embedded_raport_show = false;
		var element_start_show = false;
		var element_end_show = false;

		if (selected === "X") {
			text_show = true;
		} else if (selected === "T") {
			caption_show = true;
			spreadsheet_show = true;
			style_show = true;
			columns_show = true;
		} else if (selected === "P") {
			caption_show = true;
			plot_show = true;
		} else if (selected === "R") {
			embedded_raport_show = true;
			element_start_show = true;
			element_end_show = true;
		}

		showOrHide(text, text_show);
		showOrHide(caption, caption_show);
		showOrHide(style, style_show);
		showOrHide(spreadsheet, spreadsheet_show);
		showOrHide(plot, plot_show);
		showOrHide(embedded_raport, embedded_raport_show);
		showOrHide(element_start, element_start_show);
		showOrHide(element_end, element_end_show);
	}
</script>
{% endblock %}